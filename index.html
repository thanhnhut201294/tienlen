<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ghi ƒêi·ªÉm</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">
  <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold">Ghi ƒêi·ªÉm</h1>
      <button onclick="resetGame()" class="bg-red-500 text-white py-2 px-4 rounded hover:bg-red-600">New Game</button>
    </div>

    <!-- M√†n h√¨nh ch√≠nh -->
    <div id="main-screen" class="space-y-4">
      <button onclick="startNewGame()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">B·∫Øt ƒë·∫ßu</button>
    </div>

    <!-- Ch·ªçn s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i -->
    <div id="player-count-screen" class="hidden space-y-4">
      <h2 class="text-lg font-semibold">Ch·ªçn s·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i</h2>
      <input id="player-count" type="number" min="2" max="10" value="2" class="w-full p-2 border rounded">
      <button onclick="goToPlayerNames()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Ti·∫øp t·ª•c</button>
    </div>

    <!-- Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i -->
    <div id="player-names-screen" class="hidden space-y-4">
      <h2 class="text-lg font-semibold">Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i</h2>
      <div id="player-names-inputs"></div>
      <p id="name-error" class="text-red-500 hidden">T√™n ng∆∞·ªùi ch∆°i kh√¥ng ƒë∆∞·ª£c tr√πng nhau!</p>
      <button onclick="goToModeSelect()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Ti·∫øp t·ª•c</button>
    </div>

    <!-- Ch·ªçn ch·∫ø ƒë·ªô ch∆°i -->
    <div id="mode-select-screen" class="hidden space-y-4">
      <h2 class="text-lg font-semibold">Ch·ªçn ch·∫ø ƒë·ªô ch∆°i</h2>
      <select id="game-mode" class="w-full p-2 border rounded">
        <option value="host">C√≥ Host</option>
        <option value="winner-takes-all">Nh·∫•t ƒÇn H·∫øt</option>
        <option value="normal">B√¨nh Th∆∞·ªùng</option>
      </select>
      <div id="host-select" class="hidden">
        <label class="block">Ch·ªçn Host:</label>
        <select id="host-player" class="w-full p-2 border rounded"></select>
      </div>
      <button onclick="startGame()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">B·∫Øt ƒë·∫ßu</button>
    </div>

    <!-- Ghi ƒëi·ªÉm -->
    <div id="score-screen" class="hidden space-y-4">
      <h2 class="text-lg font-semibold">Ghi ƒëi·ªÉm</h2>
      <div id="total-scores" class="grid grid-cols-2 gap-2 mb-4"></div>
      <div id="score-inputs"></div>
      <p id="error-message" class="text-red-500 hidden">T·ªïng ƒëi·ªÉm ph·∫£i b·∫±ng 0!</p>
      <button onclick="submitScores()" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">Ghi ƒëi·ªÉm</button>
      <button onclick="showScoreTable()" class="w-full bg-gray-500 text-white py-2 rounded hover:bg-gray-600">Xem b·∫£ng ƒëi·ªÉm</button>
    </div>

    <!-- B·∫£ng ƒëi·ªÉm -->
    <div id="score-table-screen" class="hidden space-y-4">
      <h2 class="text-lg font-semibold">B·∫£ng ƒëi·ªÉm</h2>
      <table class="w-full border-collapse border mb-4">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">V√°n</th>
            ${players.map(p => `<th class="border p-2">${p}</th>`).join('')}
          </tr>
        </thead>
        <tbody id="score-table"></tbody>
      </table>
      <table class="w-full border-collapse border">
        <thead>
          <tr class="bg-gray-200">
            <th class="border p-2">Ng∆∞·ªùi ch∆°i</th>
            <th class="border p-2">T·ªïng ƒëi·ªÉm</th>
          </tr>
        </thead>
        <tbody id="total-score-table"></tbody>
      </table>
      <button onclick="backToScoreScreen()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Quay l·∫°i</button>
    </div>
  </div>

  <script>
    let players = [];
    let scores = [];
    let gameMode = '';
    let hostIndex = -1;
    let roundScoresHistory = [];

    function startNewGame() {
      document.getElementById('main-screen').classList.add('hidden');
      document.getElementById('player-count-screen').classList.remove('hidden');
    }

    function goToPlayerNames() {
      const playerCount = parseInt(document.getElementById('player-count').value);
      if (playerCount < 2 || playerCount > 10) {
        alert('S·ªë l∆∞·ª£ng ng∆∞·ªùi ch∆°i ph·∫£i t·ª´ 2 ƒë·∫øn 10!');
        return;
      }
      players = [];
      scores = [];
      roundScoresHistory = [];
      const inputsDiv = document.getElementById('player-names-inputs');
      inputsDiv.innerHTML = '';
      for (let i = 0; i < playerCount; i++) {
        inputsDiv.innerHTML += `<input id="player-${i}" type="text" placeholder="T√™n ng∆∞·ªùi ch∆°i ${i + 1}" class="w-full p-2 border rounded mb-2">`;
      }
      document.getElementById('player-count-screen').classList.add('hidden');
      document.getElementById('player-names-screen').classList.remove('hidden');
    }

    function goToModeSelect() {
      players = [];
      const nameSet = new Set();
      for (let i = 0; i < document.getElementById('player-count').value; i++) {
        const name = document.getElementById(`player-${i}`).value.trim();
        if (!name) {
          alert('Vui l√≤ng nh·∫≠p t√™n cho t·∫•t c·∫£ ng∆∞·ªùi ch∆°i!');
          return;
        }
        if (nameSet.has(name)) {
          document.getElementById('name-error').classList.remove('hidden');
          return;
        }
        nameSet.add(name);
        players.push(name);
        scores.push(0);
      }
      document.getElementById('name-error').classList.add('hidden');
      const hostSelect = document.getElementById('host-player');
      hostSelect.innerHTML = players.map((p, i) => `<option value="${i}">${p}</option>`).join('');
      document.getElementById('player-names-screen').classList.add('hidden');
      document.getElementById('mode-select-screen').classList.remove('hidden');
    }

    function startGame() {
      gameMode = document.getElementById('game-mode').value;
      if (gameMode === 'host') {
        document.getElementById('host-select').classList.remove('hidden');
        hostIndex = parseInt(document.getElementById('host-player').value);
      } else {
        document.getElementById('host-select').classList.add('hidden');
        hostIndex = -1;
      }
      renderScoreInputs();
      renderTotalScores();
      document.getElementById('mode-select-screen').classList.add('hidden');
      document.getElementById('score-screen').classList.remove('hidden');
    }

    function renderTotalScores() {
      const totalScoresDiv = document.getElementById('total-scores');
      totalScoresDiv.innerHTML = players.map((p, i) => `
        <div class="flex items-center space-x-2">
          <span>${p}:</span>
          <span class="${scores[i] >= 0 ? 'text-green-500' : 'text-red-500'}">
            ${scores[i]} ${scores[i] >= 0 ? 'üòä' : 'üò¢'}
          </span>
        </div>`).join('');
    }

    function renderScoreInputs() {
      const inputsDiv = document.getElementById('score-inputs');
      inputsDiv.innerHTML = '';
      if (gameMode === 'host') {
        players.forEach((player, i) => {
          if (i !== hostIndex) {
            inputsDiv.innerHTML += `
              <div class="flex items-center space-x-2">
                <label class="w-1/2">${player}:</label>
                <input id="score-${i}" type="number" class="w-1/2 p-2 border rounded" value="0">
              </div>`;
          }
        });
      } else if (gameMode === 'winner-takes-all') {
        inputsDiv.innerHTML = `
          <div class="flex items-center space-x-2">
            <label class="w-1/2">Ng∆∞·ªùi th·∫Øng:</label>
            <select id="winner" class="w-1/2 p-2 border rounded">
              ${players.map((p, i) => `<option value="${i}">${p}</option>`).join('')}
            </select>
          </div>
          <div class="flex items-center space-x-2">
            <label class="w-1/2">ƒêi·ªÉm th·∫Øng:</label>
            <input id="winner-score" type="number" class="w-1/2 p-2 border rounded" value="0">
          </div>`;
      } else {
        players.forEach((player, i) => {
          inputsDiv.innerHTML += `
            <div class="flex items-center space-x-2">
              <label class="w-1/2">${player}:</label>
              <input id="score-${i}" type="number" class="w-1/2 p-2 border rounded" value="0">
            </div>`;
        });
      }
    }

    function submitScores() {
      let roundScores = new Array(players.length).fill(0);
      if (gameMode === 'host') {
        let total = 0;
        players.forEach((_, i) => {
          if (i !== hostIndex) {
            const score = parseInt(document.getElementById(`score-${i}`).value) || 0;
            roundScores[i] = score;
            total += score;
          }
        });
        roundScores[hostIndex] = -total;
      } else if (gameMode === 'winner-takes-all') {
        const winnerIndex = parseInt(document.getElementById('winner').value);
        const winnerScore = parseInt(document.getElementById('winner-score').value) || 0;
        const loserScore = -winnerScore / (players.length - 1);
        players.forEach((_, i) => {
          roundScores[i] = i === winnerIndex ? winnerScore : loserScore;
        });
      } else {
        let total = 0;
        players.forEach((_, i) => {
          const score = parseInt(document.getElementById(`score-${i}`).value) || 0;
          roundScores[i] = score;
          total += score;
        });
        if (total !== 0) {
          document.getElementById('error-message').classList.remove('hidden');
          return;
        }
        document.getElementById('error-message').classList.add('hidden');
      }
      scores = scores.map((s, i) => s + roundScores[i]);
      roundScoresHistory.push(roundScores.slice());
      renderScoreInputs();
      renderTotalScores();
    }

    function showScoreTable() {
      const tableBody = document.getElementById('score-table');
      tableBody.innerHTML = roundScoresHistory.map((round, i) => `
        <tr>
          <td class="border p-2">${i + 1}</td>
          ${round.map(score => `
            <td class="border p-2 ${score >= 0 ? 'text-green-500' : 'text-red-500'}">
              ${score}
            </td>`).join('')}
        </tr>`).join('');
      const totalTableBody = document.getElementById('total-score-table');
      totalTableBody.innerHTML = players.map((p, i) => `
        <tr>
          <td class="border p-2">${p}</td>
          <td class="border p-2 ${scores[i] >= 0 ? 'text-green-500' : 'text-red-500'}">
            ${scores[i]} ${scores[i] >= 0 ? 'üòä' : 'üò¢'}
          </td>
        </tr>`).join('');
      document.getElementById('score-screen').classList.add('hidden');
      document.getElementById('score-table-screen').classList.remove('hidden');
    }

    function backToScoreScreen() {
      document.getElementById('score-table-screen').classList.add('hidden');
      document.getElementById('score-screen').classList.remove('hidden');
    }

    function resetGame() {
      document.getElementById('score-table-screen').classList.add('hidden');
      document.getElementById('score-screen').classList.add('hidden');
      document.getElementById('main-screen').classList.remove('hidden');
      players = [];
      scores = [];
      roundScoresHistory = [];
      gameMode = '';
      hostIndex = -1;
    }
  </script>
</body>
</html>
